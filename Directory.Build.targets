<!-- this file is imported after all NuGet targets are imported, so it can apply overrides before we get to the projects -->

<Project>

  <!-- debug support -->

  <PropertyGroup>
    <DebugType>none</DebugType>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)' == 'Debug' ">
    <DebugType>embedded</DebugType>
    <EmbedAllSources>true</EmbedAllSources>
  </PropertyGroup>

  <ItemGroup Condition=" '$(Configuration)' == 'Debug' ">
    <PackageReference Include="ObjectDumper.NET" />
    <Compile Include="$(OkSrcRoot)_Include\ObjectDumperExtensions.cs">
      <Link>_Include\ObjectDumperExtensions.cs</Link>
    </Compile>
  </ItemGroup>

  <!-- global usings -->

  <ItemGroup>
    <Using Include="System.Linq" />
  </ItemGroup>

  <!-- jetbrains annotations -->

  <ItemGroup>
    <Using Include="JetBrains.Annotations" />
    <PackageReference Include="JetBrains.Annotations" />
  </ItemGroup>

  <!-- exe types -->

  <Choose>
    <When Condition=" '$(OkOutputType)' == 'Docopt' ">
      <PropertyGroup>
        <OkOutputIsDocopt>true</OkOutputIsDocopt>
        <OkOutputIsCli>true</OkOutputIsCli>
        <OkOutputIsExe>true</OkOutputIsExe>
      </PropertyGroup>
    </When>
    <When Condition=" '$(OkOutputType)' == 'Cli' ">
      <PropertyGroup>
        <OkOutputIsCli>true</OkOutputIsCli>
        <OkOutputIsExe>true</OkOutputIsExe>
      </PropertyGroup>
    </When>
    <When Condition=" '$(OkOutputType)' == 'Exe' ">
      <PropertyGroup>
        <OkOutputIsExe>true</OkOutputIsExe>
      </PropertyGroup>
    </When>
  </Choose>

  <ItemGroup Condition=" '$(OkOutputIsDocopt)' == 'true' ">
    <PackageReference Include="docopt.net" />
    <Compile Include="$(OkSrcRoot)_Include\DocoptExtensions.cs">
      <Link>_Include\DocoptExtensions.cs</Link>
    </Compile>
  </ItemGroup>

  <PropertyGroup Condition=" '$(OkOutputIsExe)' == 'true' ">
    <OutputType>Exe</OutputType>
    <OutputPath>$(OkExeOutputPath)</OutputPath>

    <!-- single-file publish options -->
    <PublishSingleFile>true</PublishSingleFile>
    <SelfContained>false</SelfContained>
    <RuntimeIdentifier>win-x64</RuntimeIdentifier>

    <!-- some experiments i did on okunity...

    sizes with single-file publish..

    * not self-contained = 0.3MB
    * not self-contained+AOT = 0.5MB
    * self-contained = 62MB
    * self-contained+trimmed = 11MB
    * self-contained+trimmed+AOT = 15MB

    # enable AOT - start experimenting with this if startup time becomes noticeable
    <PublishReadyToRun>true</PublishReadyToRun>
    # bundle .net core libraries and runtime to avoid OS dependency (makes EXE humongo)
    <SelfContained>true</SelfContained>
    # effectively required by SelfContained..still have humongo EXE but about 4-5x reduced size
    <PublishTrimmed>true</PublishTrimmed>

    -->

  </PropertyGroup>

</Project>
